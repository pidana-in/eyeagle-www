---
import { Image } from "astro:assets";
import powerfulFeatDemo from "../../assets/Home/powerfulFeatDemo.png";
import Notification1 from "../../assets/Home/Notification1.png";
import Notification2 from "../../assets/Home/Notification2.png";
import Notification3 from "../../assets/Home/Notification3.png";
import { PowerfulBentoData } from "../constants/home";
import VectorArrow1 from "../../assets/Home/VectorArrow1.png"
import VectorArrow2 from "../../assets/Home/VectorArrow2.png"
import VectorArrow3 from "../../assets/Home/VectorArrow3.png"
---

<style>
  /* html {
  scroll-behavior: smooth;
} */
  .scrollbar-hidden::-webkit-scrollbar {
    display: none;
  }

  .scrollbar-hidden {
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
  }

  .your-section {
    transition: top 0.3s ease-in-out, transform 0.3s ease-in-out;
  }

  .fixed-section {
    position: sticky;
    top: 7.8rem; /* Initial sticky position */
    left: 0;
    width: 100%;
    z-index: 20;
    background: white; /* Optional: Set background to prevent transparency issues */
  }
  .visibleOne{
    opacity: 1;
    transition: 500ms ease-in-out;
    transform: translateY(0);
  }
  .visibleSecond{
    opacity: 1;
    transition: 1s ease-in-out;
    transform: translateY(0);
    transition-delay: 400ms;
  }
  .visibleThird{
    opacity: 1;
    transition: 1s ease-in-out;
    transform: translateY(0);
    transition-delay: 400ms;
  }
  .visibleForth{
    opacity: 1;
    transition: 1s ease-in-out;
    top: 0;
    transition-delay: 100ms;
  }
  .visibleFifth {
  opacity: 1;
  transition: 1s ease-in-out;
  transform: translateY(0);
  transition-delay: 200ms;
}

.visibleSixth {
  opacity: 1;
  transition: 1s ease-in-out;
  transform: translateY(0);
  transition-delay: 100ms;
}

  .noVisible{
    opacity: 0;
    transform: translateY(35px);
    transition: opacity 1s, transform 1s;
  }

  
</style>
<section class="xl:container">

  <div class="h-[1700px] font-sans-instrument">
    <div class="your-section fixed-section">
      <Image src={powerfulFeatDemo} alt={"powerfulBento"} class={"px-20 mt-10"} />
      <Image id={"notification1"} src={Notification1} alt={"notification1"} class={"px-20 py-16 absolute w-[40%] right-24 top-4 noVisible"} />
      <Image id={"notification2"} src={Notification2} alt={"notification2"} class={"px-20 py-14 absolute w-[40%] right-20 top-44 noVisible"} />
      <Image id={"notification3"} src={Notification3} alt={"notification3"} class={"px-20 py-10 absolute w-[40%] right-14 bottom-10 noVisible"} />
      
      <div class="text-one noVisible absolute top-24 left-28">
        <p class="font-normal text-xl leading-8">24/7 <span class="text-primary">EyEagle</span> team reach</p>
        <Image src={VectorArrow1} alt={"VectorArrow1"} class="absolute left-44 top-10 w-[90%]" />
      </div>
      <div class="text-second noVisible absolute top-[300px] left-28">
        <p class="font-normal text-xl leading-8">Easily get updates from all<br/> the devices in one circle</p>
        <Image src={VectorArrow2} alt={"VectorArrow2"} class="absolute left-60 top-10 w-[80%]" />
      </div>
      <div class="text-third noVisible absolute top-[480px] left-28">
        <p class="font-normal text-xl leading-8">Details & Documents<br/> readily available for<br/> emergencies</p>
        <Image src={VectorArrow3} alt={"VectorArrow3"} class="absolute left-52 top-10 w-[120%]" />
      </div>
    </div>
  </div>
  <div class="lg:flex grid gap-16 px-20 lg:h-[39.938rem] my-10">
    <div>
      <Image src={PowerfulBentoData.featsrc1} alt={"featSrc1"} class={"w-full h-full"}/>
    </div>
    <div>
      <Image src={PowerfulBentoData.featsrc2} alt={"featSrc2"} class={"w-full h-full"}/>
    </div>
  </div>
</section>

<script is:inline>
  const section = document.querySelector(".your-section");

  const elements = [
    { el: document.querySelector(".text-one"), class: "visibleOne", threshold: 100 },
    { el: document.querySelector(".text-second"), class: "visibleSecond", threshold: 250 },
    { el: document.querySelector(".text-third"), class: "visibleThird", threshold: 450 },
    { el: document.querySelector("#notification1"), class: "visibleForth", threshold: 600 },
    { el: document.querySelector("#notification2"), class: "visibleFifth", threshold: 750 },
    { el: document.querySelector("#notification3"), class: "visibleSixth", threshold: 900 }
  ];

  let revealed = new Set();
  let scrollStart = 0;
  let trackingScroll = false;

  function isSectionFullScreen() {
    const rect = section.getBoundingClientRect();
    return rect.top <= 125;
  }

  function resetElements() {
    revealed.clear();
    elements.forEach(({ el, class: visibleClass }) => {
      el.classList.remove(visibleClass);
      el.classList.add("noVisible");
    });
  }

  window.addEventListener("scroll", () => {
    if (isSectionFullScreen()) {
      if (!trackingScroll) {
        trackingScroll = true;
        scrollStart = window.scrollY;
      }

      const scrollDistance = window.scrollY - scrollStart;

      // Reset if scrolled too far down or up
      if (scrollDistance > 1200 || scrollDistance < -300) {
        resetElements();
        scrollStart = window.scrollY; // restart tracking from current position
        return;
      }

      elements.forEach(({ el, class: visibleClass, threshold }) => {
        if (!revealed.has(visibleClass) && scrollDistance >= threshold) {
          el.classList.remove("noVisible");
          el.classList.add(visibleClass);
          revealed.add(visibleClass);
        }
      });

    } else {
      // If section out of view, reset scroll tracking only
      trackingScroll = false;
    }
  });
</script>


